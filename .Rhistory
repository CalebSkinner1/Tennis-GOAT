# group_by(name) %>%
summarize(
`Total Points` = sum(points) + sum(bonus),
`Victory Points` = sum(points),
`Bonus Points` = sum(bonus),
Victories = sum(points > 0),
Defeats = sum(points < 0),
`Win Percent` = scales::percent(Victories/(Victories + Defeats), accuracy = .01)) %>%
ungroup() %>%
rename(
Country = ioc,
Name = name) %>%
arrange(desc(`Total Points`)) %>%
mutate(
Rank = row_number(),
`Birth Year` = year(dob))
library("tidyverse"); theme_set(theme_minimal())
library("here")
library("flextable")
matches <- read_csv(here("data/gs_matches.csv"))
players <- read_csv(here("data/gs_players.csv"))
set_flextable_defaults(
font.size = 10, theme_fun = theme_zebra,
padding = 3,
background.color = "#EFEFEF",
text.align = "center")
players %>%
group_by(name, dob, ioc) %>%
# group_by(name) %>%
summarize(
`Total Points` = sum(points) + sum(bonus),
`Victory Points` = sum(points),
`Bonus Points` = sum(bonus),
Victories = sum(points > 0),
Defeats = sum(points < 0),
`Win Percent` = scales::percent(Victories/(Victories + Defeats), accuracy = .01)) %>%
ungroup() %>%
rename(
Country = ioc,
Name = name) %>%
arrange(desc(`Total Points`)) %>%
mutate(
Rank = row_number(),
`Birth Year` = year(dob)) %>%
relocate(Rank, .before = Name) %>%
relocate(`Birth Year`, .before = Country)
#| tbl-cap: Best Player by Year of Birth
players %>%
group_by(name, dob, ioc) %>%
# group_by(name) %>%
summarize(
`Total Points` = sum(points) + sum(bonus),
`Victory Points` = sum(points),
`Bonus Points` = sum(bonus),
Victories = sum(points > 0),
Defeats = sum(points < 0),
`Win Percent` = scales::percent(Victories/(Victories + Defeats), accuracy = .01)) %>%
ungroup() %>%
rename(
Country = ioc,
Name = name) %>%
arrange(desc(`Total Points`)) %>%
mutate(
Rank = row_number(),
`Birth Year` = year(dob)) %>%
relocate(Rank, .before = Name) %>%
relocate(`Birth Year`, .before = Country) %>%
select(-dob)
#| tbl-cap: Best Player by Year of Birth
players %>%
group_by(name, dob, ioc) %>%
# group_by(name) %>%
summarize(
`Total Points` = sum(points) + sum(bonus),
`Victory Points` = sum(points),
`Bonus Points` = sum(bonus),
Victories = sum(points > 0),
Defeats = sum(points < 0),
`Win Percent` = scales::percent(Victories/(Victories + Defeats), accuracy = .01)) %>%
ungroup() %>%
rename(
Country = ioc,
Name = name) %>%
arrange(desc(`Total Points`)) %>%
mutate(
Rank = row_number(),
`Birth Year` = year(dob)) %>%
relocate(Rank, .before = Name) %>%
relocate(`Birth Year`, .before = Country) %>%
select(-dob) %>%
group_by(`Birth Year`) %>%
mutate(rank_year = row_number())
#| tbl-cap: Best Player by Year of Birth
players %>%
group_by(name, dob, ioc) %>%
# group_by(name) %>%
summarize(
`Total Points` = sum(points) + sum(bonus),
`Victory Points` = sum(points),
`Bonus Points` = sum(bonus),
Victories = sum(points > 0),
Defeats = sum(points < 0),
`Win Percent` = scales::percent(Victories/(Victories + Defeats), accuracy = .01)) %>%
ungroup() %>%
rename(
Country = ioc,
Name = name) %>%
arrange(desc(`Total Points`)) %>%
mutate(
Rank = row_number(),
`Birth Year` = year(dob)) %>%
relocate(Rank, .before = Name) %>%
relocate(`Birth Year`, .before = Country) %>%
select(-dob) %>%
group_by(`Birth Year`) %>%
mutate(rank_year = row_number()) %>%
filter(rank_year == 1)
#| tbl-cap: Best Player by Year of Birth
players %>%
group_by(name, dob, ioc) %>%
# group_by(name) %>%
summarize(
`Total Points` = sum(points) + sum(bonus),
`Victory Points` = sum(points),
`Bonus Points` = sum(bonus),
Victories = sum(points > 0),
Defeats = sum(points < 0),
`Win Percent` = scales::percent(Victories/(Victories + Defeats), accuracy = .01)) %>%
ungroup() %>%
rename(
Country = ioc,
Name = name) %>%
arrange(desc(`Total Points`)) %>%
mutate(
Rank = row_number(),
`Birth Year` = year(dob)) %>%
relocate(Rank, .before = Name) %>%
relocate(`Birth Year`, .before = Country) %>%
select(-dob) %>%
group_by(`Birth Year`) %>%
mutate(rank_year = row_number()) %>%
filter(rank_year == 1) %>%
arrange(`Birth Year`)
#| tbl-cap: Best Player by Year of Birth
players %>%
group_by(name, dob, ioc) %>%
# group_by(name) %>%
summarize(
`Total Points` = sum(points) + sum(bonus),
`Victory Points` = sum(points),
`Bonus Points` = sum(bonus),
Victories = sum(points > 0),
Defeats = sum(points < 0),
`Win Percent` = scales::percent(Victories/(Victories + Defeats), accuracy = .01)) %>%
ungroup() %>%
rename(
Country = ioc,
Name = name) %>%
arrange(desc(`Total Points`)) %>%
mutate(
Rank = row_number(),
`Birth Year` = year(dob)) %>%
relocate(Rank, .before = Name) %>%
relocate(`Birth Year`, .before = Country) %>%
select(-dob) %>%
group_by(`Birth Year`) %>%
mutate(rank_year = row_number()) %>%
filter(rank_year == 1) %>%
arrange(`Birth Year`) %>%
filter(`Birth Year` > 1933) %>%
flextable() %>%
align(align = "center", part = "all") %>%
width(j = 10, width = 1.3) %>%
width(j = 2, width = 2.2) %>%
width(j = c(1,4,8:9), width = .7) %>%
colformat_double(j = c(5,7,8,9), digits = 0)
#| tbl-cap: Best Player by Year of Birth
players %>%
group_by(name, dob, ioc) %>%
# group_by(name) %>%
summarize(
`Total Points` = sum(points) + sum(bonus),
`Victory Points` = sum(points),
`Bonus Points` = sum(bonus),
Victories = sum(points > 0),
Defeats = sum(points < 0),
`Win Percent` = scales::percent(Victories/(Victories + Defeats), accuracy = .01)) %>%
ungroup() %>%
rename(
Country = ioc,
Name = name) %>%
arrange(desc(`Total Points`)) %>%
mutate(
Rank = row_number(),
`Birth Year` = year(dob)) %>%
relocate(Rank, .before = Name) %>%
relocate(`Birth Year`, .before = Country) %>%
select(-dob) %>%
group_by(`Birth Year`) %>%
mutate(rank_year = row_number()) %>%
filter(rank_year == 1) %>%
arrange(`Birth Year`) %>%
filter(`Birth Year` > 1933) %>%
select(-rank_year) %>%
flextable() %>%
align(align = "center", part = "all") %>%
width(j = 10, width = 1.3) %>%
width(j = 2, width = 2.2) %>%
width(j = c(1,4,8:9), width = .7) %>%
colformat_double(j = c(5,7,8,9), digits = 0)
#| tbl-cap: Best Player by Year of Birth
players %>%
group_by(name, dob, ioc) %>%
# group_by(name) %>%
summarize(
`Total Points` = sum(points) + sum(bonus),
`Victory Points` = sum(points),
`Bonus Points` = sum(bonus),
Victories = sum(points > 0),
Defeats = sum(points < 0),
`Win Percent` = scales::percent(Victories/(Victories + Defeats), accuracy = .01)) %>%
ungroup() %>%
rename(
Country = ioc,
Name = name) %>%
arrange(desc(`Total Points`)) %>%
mutate(
Rank = row_number(),
`Birth Year` = year(dob)) %>%
relocate(Rank, .before = Name) %>%
relocate(`Birth Year`, .before = Country) %>%
select(-dob) %>%
group_by(`Birth Year`) %>%
mutate(rank_year = row_number()) %>%
filter(rank_year == 1) %>%
arrange(`Birth Year`) %>%
filter(`Birth Year` > 1933) %>%
select(-rank_year) %>%
flextable() %>%
align(align = "center", part = "all") %>%
width(j = 10, width = 1.3) %>%
width(j = 2, width = 2.2) %>%
width(j = c(1,4,8:9), width = .7) %>%
colformat_double(j = c(5,7,8,9), digits = 0) %>%
colformat_double(
big.mark = ",", digits = 2, na_str = "N/A")
#| tbl-cap: Best Player by Year of Birth
players %>%
group_by(name, dob, ioc) %>%
# group_by(name) %>%
summarize(
`Total Points` = sum(points) + sum(bonus),
`Victory Points` = sum(points),
`Bonus Points` = sum(bonus),
Victories = sum(points > 0),
Defeats = sum(points < 0),
`Win Percent` = scales::percent(Victories/(Victories + Defeats), accuracy = .01)) %>%
ungroup() %>%
rename(
Country = ioc,
Name = name) %>%
arrange(desc(`Total Points`)) %>%
mutate(
Rank = row_number(),
`Birth Year` = year(dob)) %>%
relocate(Rank, .before = Name) %>%
relocate(`Birth Year`, .before = Country) %>%
select(-dob) %>%
group_by(`Birth Year`) %>%
mutate(rank_year = row_number()) %>%
filter(rank_year == 1) %>%
arrange(`Birth Year`) %>%
filter(`Birth Year` > 1933) %>%
select(-rank_year) %>%
flextable() %>%
align(align = "center", part = "all") %>%
width(j = 10, width = 1.3) %>%
width(j = 2, width = 2.2) %>%
width(j = c(1,4,8:9), width = .7) %>%
colformat_double(j = c(5,7,8,9), digits = 0) %>%
colformat_double(j = 3,
big.mark = ",", digits = 0, na_str = "N/A")
#| tbl-cap: Best Player by Year of Birth
players %>%
group_by(name, dob, ioc) %>%
# group_by(name) %>%
summarize(
`Total Points` = sum(points) + sum(bonus),
`Victory Points` = sum(points),
`Bonus Points` = sum(bonus),
Victories = sum(points > 0),
Defeats = sum(points < 0),
`Win Percent` = scales::percent(Victories/(Victories + Defeats), accuracy = .01)) %>%
ungroup() %>%
rename(
Country = ioc,
Name = name) %>%
arrange(desc(`Total Points`)) %>%
mutate(
Rank = row_number(),
`Birth Year` = year(dob)) %>%
relocate(Rank, .before = Name) %>%
relocate(`Birth Year`, .before = Country) %>%
select(-dob) %>%
group_by(`Birth Year`) %>%
mutate(rank_year = row_number()) %>%
filter(rank_year == 1) %>%
arrange(`Birth Year`) %>%
filter(`Birth Year` > 1933) %>%
select(-rank_year) %>%
flextable() %>%
align(align = "center", part = "all") %>%
width(j = 10, width = 1.3) %>%
width(j = 2, width = 2.2) %>%
width(j = c(1,4,8:9), width = .7) %>%
colformat_double(j = c(5,7,8,9), digits = 0) %>%
colformat_double(j = 3,
big.mark = "N/A", digits = 0, na_str = "N/A")
#| tbl-cap: Best Player by Year of Birth
players %>%
group_by(name, dob, ioc) %>%
# group_by(name) %>%
summarize(
`Total Points` = sum(points) + sum(bonus),
`Victory Points` = sum(points),
`Bonus Points` = sum(bonus),
Victories = sum(points > 0),
Defeats = sum(points < 0),
`Win Percent` = scales::percent(Victories/(Victories + Defeats), accuracy = .01)) %>%
ungroup() %>%
rename(
Country = ioc,
Name = name) %>%
arrange(desc(`Total Points`)) %>%
mutate(
Rank = row_number(),
`Birth Year` = year(dob)) %>%
relocate(Rank, .before = Name) %>%
relocate(`Birth Year`, .before = Country) %>%
select(-dob) %>%
group_by(`Birth Year`) %>%
mutate(rank_year = row_number()) %>%
filter(rank_year == 1) %>%
arrange(`Birth Year`) %>%
filter(`Birth Year` > 1933) %>%
select(-rank_year) %>%
flextable() %>%
align(align = "center", part = "all") %>%
width(j = 10, width = 1.3) %>%
width(j = 2, width = 2.2) %>%
width(j = c(1,4,8:9), width = .7) %>%
colformat_double(j = c(5,7,8,9), digits = 0) %>%
colformat_double(j = 3,
big.mark = "", digits = 0, na_str = "N/A")
knitr::opts_chunk$set(
comment = "#", fig.height = 3,
cache = FALSE, collapse = TRUE,
error = TRUE, echo = FALSE,
message = FALSE,
warning = FALSE)
#| tbl-cap: Player Rankings by Grand Slam Results
players %>%
group_by(name, dob, ioc) %>%
summarize(
Titles = sum(result == "winner" & round == "F"),
Finals = sum(round == "F"),
Semis = sum(round == "SF"),
Quarters = sum(round == "QF"),
"4th Round" = sum(round == "R16"),
"3rd Round" = sum(round == "R32"),
"2nd Round" = sum(round == "R64"),
"1st Round" = sum(round == "R128")) %>%
arrange(desc(Titles), desc(Finals), desc(Semis), desc(Quarters),
desc(`4th Round`), desc(`3rd Round`), desc(`2nd Round`), desc(`1st Round`)) %>%
ungroup() %>%
mutate(
Rank = row_number(),
`Birth Year` = year(dob)) %>%
relocate(Rank, .before = name) %>%
rename(
Country = ioc,
Name = name) %>%
relocate(`Birth Year`, .before = Country) %>%
select(-dob) %>%
slice(1:25) %>%
flextable() %>%
align(align = "center", part = "all") %>%
width(j= 2, width = 2) %>%
width(j = 3, width = 1.9) %>%
width(j = c(1, 4), width = .7) %>%
width(j = c(9:12), width = 1) %>%
colformat_double(j = 5, digits = 0) %>%
colformat_double(j = 3,
big.mark = "", digits = 0, na_str = "N/A")
#| tbl-cap: Top Players without a Grand Slam
players %>%
group_by(name, dob, ioc) %>%
# group_by(name) %>%
summarize(
`Total Points` = sum(points) + sum(bonus),
`Victory Points` = sum(points),
`Bonus Points` = sum(bonus),
Titles = sum(round == "F" & result == "winner"),
Finals = sum(round == "F"),
Victories = sum(points > 0),
Defeats = sum(points < 0),
`Win Percent` = scales::percent(Victories/(Victories + Defeats), accuracy = .01)) %>%
ungroup() %>%
rename(
Country = ioc,
Name = name) %>%
filter(Titles == 0) %>%
arrange(desc(`Total Points`)) %>%
mutate(
Rank = row_number(),
`Birth Year` = year(dob)) %>%
relocate(Rank, .before = Name) %>%
relocate(`Birth Year`, .before = Country) %>%
select(-dob, -Titles) %>%
slice(1:25) %>%
flextable() %>%
align(align = "center", part = "all") %>%
width(j = 11, width = 1.3) %>%
width(j = 2, width = 2.2) %>%
width(j = c(1,4,8:10), width = .7) %>%
colformat_double(j = c(5:9), digits = 0) %>%
colformat_double(j = 3,
big.mark = "", digits = 0, na_str = "N/A")
knitr::opts_chunk$set(
comment = "#", fig.height = 3,
cache = FALSE, collapse = TRUE,
error = TRUE, echo = FALSE,
message = FALSE,
warning = FALSE)
active %>%
flextable() %>%
align(align = "center", part = "all") %>%
width(j = 12, width = 1.3) %>%
width(j = 2, width = 2.2) %>%
width(j = c(1,4,8:11), width = .7) %>%
colformat_double(j = c(3,5:9), digits = 0) %>%
colformat_double(j = 3,
big.mark = "", digits = 0, na_str = "N/A")
#| fig-cap: Average Age of Top 50 Players
rankings <- read_csv(files_rankings, id = "path") %>%
rename(player_id = player) %>%
mutate(date = ymd(ranking_date)) %>%
select(-path, -points, -ranking_date) %>%
left_join(players_info, by = join_by(player_id)) %>%
arrange(date, rank)
#| fig-cap: Average Age of Top 50 Players
rankings <- read_csv(files_rankings, id = "path") %>%
rename(player_id = player) %>%
mutate(date = ymd(ranking_date)) %>%
select(-path, -points, -ranking_date) %>%
left_join(players_info, by = join_by(player_id)) %>%
arrange(date, rank)
last_issue <- rankings %>%
select(date) %>%
distinct() %>%
mutate(year = year(date)) %>%
group_by(year) %>%
summarize(date = max(date)) %>%
select(date) %>% pull()
rankings_100 <- rankings %>% filter(date %in% last_issue, rank < 101)
rankings_50 <- rankings %>% filter(date %in% last_issue, rank < 51) %>%
relocate(player, .before = player_id) %>%
rename(rank_date = date) %>%
relocate(rank_date, .before = rank) %>%
mutate(
dob = ymd(dob),
age = time_length(rank_date - dob, "years"))
rankings_50
rankings_50 <- rankings %>% filter(date %in% last_issue, rank < 51) %>%
relocate(player, .before = player_id) %>%
rename(rank_date = date) %>%
relocate(rank_date, .before = rank) %>%
mutate(
dob = ymd(dob),
Year = year(rank_date),
age = time_length(rank_date - dob, "years")) %>%
group_by(Year) %>%
summarize(
`Average Age` = mean(age)
)
rankings %>% filter(date %in% last_issue, rank < 51) %>%
relocate(player, .before = player_id) %>%
rename(rank_date = date) %>%
relocate(rank_date, .before = rank) %>%
mutate(
dob = ymd(dob),
Year = year(rank_date),
age = time_length(rank_date - dob, "years")) %>%
group_by(Year) %>%
summarize(
`Average Age` = mean(age)) %>%
ggplot() +
geom_line(aes(x = Year, y = `Average Age`))
rankings %>% filter(date %in% last_issue, rank < 51) %>%
relocate(player, .before = player_id) %>%
rename(rank_date = date) %>%
relocate(rank_date, .before = rank) %>%
mutate(
dob = ymd(dob),
year = year(rank_date),
age = time_length(rank_date - dob, "years")) %>%
group_by(year) %>%
summarize(
average_age = mean(age)) %>%
ggplot() +
geom_line(aes(x = year, y = average_age), color = "cadetblue4") +
labs(x = "Year", y = "Age")
