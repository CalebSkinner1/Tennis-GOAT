# Player Birthplace and age

# load in data
library("tidyverse")
library("janitor")
library("here")
library("plotly")

path_to_file <- here("data")

players_info <- read_csv(here("data/atp_players.csv")) %>%
  mutate(player = str_c(name_first, " ", name_last)) %>%
  select(-contains("name"), -wikidata_id)

files_rankings <- fs::dir_ls(path = path_to_file, glob = "*atp_ranking_*csv")

rankings <- read_csv(files_rankings, id = "path") %>%
  rename(player_id = player) %>%
  mutate(date = ymd(ranking_date)) %>%
  select(-path, -points, -ranking_date) %>%
  left_join(players_info, by = join_by(player_id)) %>%
  arrange(date, rank)

last_issue <- rankings %>%
  select(date) %>%
  distinct() %>%
  mutate(year = year(date)) %>%
  group_by(year) %>%
  summarize(date = max(date)) %>%
  select(date) %>% pull()

rankings_100 <- rankings %>% filter(date %in% last_issue, rank < 101) %>%
  relocate(player, .before = player_id) %>%
  rename(rank_date = date) %>%
  relocate(rank_date, .before = rank) %>%
  mutate(
    dob = ymd(dob),
    age = time_length(rank_date - dob, "years")) %>%
  mutate(
    birth_lat = case_when(
      player == "Novak Djokovic" ~ 44.8178131,
      player == "Carlos Alcaraz" ~ 37.94133758544922,
      player == "Jannik Sinner" ~ 46.7328719,
      player == "Daniil Medvedev" ~ 55.7505412,
      player == "Andrey Rublev" ~ 55.7505412,
      player == "Stefanos Tsitsipas" ~ 39.4899739,
      player == "Alexander Zverev" ~ 53.550341,
      player == "Holger Rune" ~ 55.7535946,
      player == "Hubert Hurkacz" ~ 51.1089776,
      player == "Taylor Fritz" ~ 32.7174202,
      player == "Casper Ruud" ~ 59.9133301,
      player == "Alex De Minaur" ~ -33.8698439,
      player == "Tommy Paul" ~ 39.8512162,
      player == "Grigor Dimitrov" ~ 41.763101,
      player == "Karen Khachanov" ~ 55.7505412,
      player == "Frances Tiafoe" ~ 38.9529442 ,
      player == "Ben Shelton" ~ 33.7489924,
      player == "Cameron Norrie" ~ -26.205,
      player == "Nicolas Jarry" ~ -33.4377756,
      player == "Ugo Humbert" ~ 49.1196964,
      player == "Francisco Cerundolo" ~ -34.6073387,
      player == "Adrian Mannarino" ~ 48.9875044,
      player == "Tallon Griekspoor" ~ 52.3837058,
      player == "Sebastian Korda" ~ 27.4989278,
      player == "Jan Lennard Struff" ~ 51.4458105,
      player == "Alejandro Davidovich Fokina" ~ 36.7162109,
      player == "Lorenzo Musetti" ~ 44.0771026,
      player == "Sebastian Baez" ~ -34.6073387,
      player == "Felix Auger Aliassime" ~ 45.5031824,
      player == "Tomas Martin Etcheverry" ~ -34.9206797,
      player == "Jiri Lehecka" ~ 50.4116187,
      player == "Alexander Bublik" ~ 59.5706273,
      player == "Laslo Djere" ~ 45.9312407,
      player == "Christopher Eubanks" ~ 33.7489924,
      player == "Aslan Karatsev" ~ 43.024593,
      player == "Arthur Fils" ~ 48.6137157,
      player == "Borna Coric" ~ 45.8130967,
      player == "Daniel Evans" ~ 52.4796992,
      player == "Roman Safiullin" ~ 55.4308841,
      player == "Alexei Popyrin" ~ -33.8698439,
      player == "Mackenzie Mcdonald" ~ 37.8708393,
      player == "Andy Murray" ~ 55.861155,
      player == "Sebastian Ofner" ~ 47.4121987,
      player == "Matteo Arnaldi" ~ 43.8198253,
      player == "Max Purcell" ~ -33.8698439,
      player == "Lorenzo Sonego" ~ 45.0677551,
      player == "Yoshihito Nishioka" ~ 34.7341973,
      player == "Alexander Shevchenko" ~ 47.2610441,
      player == "Stan Wawrinka" ~ 46.5218269,
      player == "Botic Van De Zandschulp" ~ 51.9663016,
      player == "Yannick Hanfmann" ~ 49.0068705,
      player == "Dusan Lajovic" ~ 44.8178131,
      player == "J J Wolf" ~ 39.1014537,
      player == "Miomir Kecmanovic" ~ 44.8178131,
      player == "Jordan Thompson" ~ -33.8698439,
      player == "Daniel Altmaier" ~ 51.3642126,
      player == "Roberto Bautista Agut" ~ 39.9860347,
      player == "Zhizhen Zhang" ~ 31.2323437,
      player == "Marton Fucsovics" ~ 47.9557802,
      player == "Marcos Giron" ~ 34.1705609,
      player == "Jack Draper" ~ 51.3574644,
      player == "Aleksandar Vukic" ~ -33.8698439,
      player == "Roberto Carballes Baena" ~ 28.467178,
      player == "Fabian Marozsan" ~ 47.4978789,
      player == "Thanasi Kokkinakis" ~ -34.9281805,
      player == "Nuno Borges" ~ 41.2373456,
      player == "Pavel Kotov" ~ 55.7505412,
      player == "Christopher Oconnell" ~ -33.8698439,
      player == "Pedro Cachin" ~ -32.6300707,
      player == "Rinky Hijikata" ~ -33.8698439,
      player == "Borna Gojo" ~ 43.5116383,
      player == "Benjamin Bonzi" ~ 43.8374249,
      player == "Gael Monfils" ~ 48.8588897,
      player == "Taro Daniel" ~ 40.7127281,
      player == "Richard Gasquet" ~ 43.3426562,
      player == "Dominik Koepfer" ~ 48.0512198,
      player == "Tomas Machac" ~ 49.9640292,
      player == "Thiago Seyboth Wild" ~ -24.5,
      player == "Bernabe Zapata Miralles" ~ 39.4697065,
      player == "Alexandre Muller" ~ 48.927439,
      player == "Cristian Garin" ~ -18.4785288,
      player == "Juan Pablo Varillas" ~ -12.0621065,
      player == "Gregoire Barrere" ~ 48.8033057,
      player == "Alejandro Tabilo" ~ 43.6534817,
      player == "Jaume Munar" ~ 39.3543115,
      player == "Constant Lestienne" ~ 49.8941708,
      player == "Federico Coria" ~ -32.9593609,
      player == "Albert Ramos" ~ 41.3828939,
      player == "Luca Van Assche" ~ 50.8430448,
      player == "Maximilian Marterer" ~ 49.453872,
      player == "Matteo Berrettini" ~ 41.8933203,
      player == "Daniel Elahi Galan" ~ 7.1255169,
      player == "Dominic Stricker" ~ 46.8739775,
      player == "Facundo Diaz Acosta" ~ -34.6073387,
      player == "Arthur Rinderknech" ~ 43.2291533,
      player == "Alex Michelsen" ~ 33.5761376,
      player == "Dominic Thiem" ~ 47.8131847,
      player == "Yosuke Watanuki" ~ 35.8616402,
      player == "Quentin Halys" ~ 48.9031,
      player == "Emil Ruusuvuori" ~ 60.1674881,
      ),
    birth_long = case_when(
      player == "Novak Djokovic" ~ 20.4568974,
      player == "Carlos Alcaraz" ~ -1.1545771360397339,
      player == "Jannik Sinner" ~ 12.2791673,
      player == "Daniil Medvedev" ~ 37.6174782,
      player == "Andrey Rublev" ~ 37.6174782,
      player == "Stefanos Tsitsipas" ~ 21.9024738,
      player == "Alexander Zverev" ~ 10.000654,
      player == "Holger Rune" ~ 12.541436,
      player == "Hubert Hurkacz" ~ 17.0326689,
      player == "Taylor Fritz" ~ -117.162772,
      player == "Casper Ruud" ~ 10.7389701,
      player == "Alex De Minaur" ~ 151.2082848,
      player == "Tommy Paul" ~ -74.9619779,
      player == "Grigor Dimitrov" ~ 25.9256255,
      player == "Karen Khachanov" ~ 37.6174782,
      player == "Frances Tiafoe" ~ 76.9408647,
      player == "Ben Shelton" ~ 84.3902644,
      player == "Cameron Norrie" ~ 28.049722,
      player == "Nicolas Jarry" ~ -70.6504502,
      player == "Ugo Humbert" ~ 6.1763552,
      player == "Francisco Cerundolo" ~ -58.4432852,
      player == "Adrian Mannarino" ~ 2.3002885,
      player == "Tallon Griekspoor" ~ 4.6435597,
      player == "Sebastian Korda" ~ -82.5748194,
      player == "Jan Lennard Struff" ~ 8.3536824,
      player == "Alejandro Davidovich Fokina" ~ -4.2793767,
      player == "Lorenzo Musetti" ~ 10.096726,
      player == "Sebastian Baez" ~ -58.4432852,
      player == "Felix Auger Aliassime" ~ -73.5698065,
      player == "Tomas Martin Etcheverry" ~ -57.9537638,
      player == "Jiri Lehecka" ~ 14.9031301,
      player == "Alexander Bublik" ~ 30.1305083,
      player == "Laslo Djere" ~ 20.0901597,
      player == "Christopher Eubanks" ~ -84.3902644,
      player == "Aslan Karatsev" ~ 44.68211,
      player == "Arthur Fils" ~ 2.3805119,
      player == "Borna Coric" ~ 15.9772795,
      player == "Daniel Evans" ~ -1.9026911,
      player == "Roman Safiullin" ~ 37.5453056,
      player == "Alexei Popyrin" ~ 151.2082848,
      player == "Mackenzie Mcdonald" ~ -122.272863,
      player == "Andy Murray" ~ -4.2501687,
      player == "Sebastian Ofner" ~ 15.2721668,
      player == "Matteo Arnaldi" ~ 7.7748827,
      player == "Max Purcell" ~ 151.2082848,
      player == "Lorenzo Sonego" ~ 7.6824892,
      player == "Yoshihito Nishioka" ~ 136.5153283,
      player == "Alexander Shevchenko" ~ 39.7249086,
      player == "Stan Wawrinka" ~ 6.6327025,
      player == "Botic Van De Zandschulp" ~ 5.6662814,
      player == "Yannick Hanfmann" ~ 8.4034195,
      player == "Dusan Lajovic" ~ 20.4568974,
      player == "J J Wolf" ~ -84.5124602,
      player == "Miomir Kecmanovic" ~ 20.4568974,
      player == "Jordan Thompson" ~ 151.2082848,
      player == "Daniel Altmaier" ~ 6.4195011,
      player == "Roberto Bautista Agut" ~ -0.0377354,
      player == "Zhizhen Zhang" ~ 121.4691024,
      player == "Marton Fucsovics" ~ 21.7167982,
      player == "Marcos Giron" ~ -118.8375937,
      player == "Jack Draper" ~ -0.1736269,
      player == "Aleksandar Vukic" ~ 151.2082848,
      player == "Roberto Carballes Baena" ~ -16.2507843,
      player == "Fabian Marozsan" ~ 19.0402383,
      player == "Thanasi Kokkinakis" ~ 138.5999312,
      player == "Nuno Borges" ~ -8.6299982,
      player == "Pavel Kotov" ~ 37.6174782,
      player == "Christopher Oconnell" ~ 151.2082848,
      player == "Pedro Cachin" ~ -62.6888782,
      player == "Rinky Hijikata" ~ 151.2082848,
      player == "Borna Gojo" ~ 16.4399659,
      player == "Benjamin Bonzi" ~ 4.3600687,
      player == "Gael Monfils" ~ 2.320041,
      player == "Taro Daniel" ~ -74.0060152,
      player == "Richard Gasquet" ~ 3.2131307,
      player == "Dominik Koepfer" ~ 8.2073776,
      player == "Tomas Machac" ~ 14.0733907,
      player == "Thiago Seyboth Wild" ~ -51.33333,
      player == "Bernabe Zapata Miralles" ~ -0.3763353,
      player == "Alexandre Muller" ~ 2.0428293,
      player == "Cristian Garin" ~ -70.3211394,
      player == "Juan Pablo Varillas" ~ -77.0365256,
      player == "Gregoire Barrere" ~ 2.4853015,
      player == "Alejandro Tabilo" ~ -79.3839347,
      player == "Jaume Munar" ~ 3.1294799,
      player == "Constant Lestienne" ~ 2.2956951,
      player == "Federico Coria" ~ -60.6617024,
      player == "Albert Ramos" ~ 2.1774322,
      player == "Luca Van Assche" ~ 4.4256732,
      player == "Maximilian Marterer" ~ 11.077298,
      player == "Matteo Berrettini" ~ 12.4829321,
      player == "Daniel Elahi Galan" ~ -73.1182624,
      player == "Dominic Stricker" ~ 7.5631943,
      player == "Facundo Diaz Acosta" ~ -58.4432852,
      player == "Arthur Rinderknech" ~ 6.585476,
      player == "Alex Michelsen" ~ -117.7258122,
      player == "Dominic Thiem" ~ 16.2441166,
      player == "Yosuke Watanuki" ~ 139.6457957,
      player == "Quentin Halys" ~ 2.48291,
      player == "Emil Ruusuvuori" ~ 24.9427473,
      player == "Rafael Nadal" ~ 3.2106461,
      player == "Robin Soderling" ~ 14.2,
      player == "Roger Federer" ~ 7.5878261,
      player == "Tomas Berdych" ~ 17.971593,
      player == "David Ferrer" ~ 0.1634168,
      player == "Andy Roddick" ~ -95.9383758,
      player == "Fernando Verdasco" ~ -3.7035825,
      player == "Mikhail Youzhny" ~ 37.6063916,
      player == "Jurgen Melzer" ~ 16.3725042,
      player == "Jo-Wilfried Tsonga" ~ 0.1967849,
      player == "Marin Cilic" ~ 16.9797134,
      player == "Nicolas Almagro" ~ -1.1305431,
      player == "Mardy Fish" ~ -93.3501222,
      player == "Ivan Ljubicic" ~ 17.1917651,
      player == "Sam Querrey" ~ -122.4193286,
      player == "John Isner" ~ -79.7919754,
      player == "Marcos Baghdatis" ~ 33.0332657,
      player == "Nikolay Davydenko" ~ 38.4936475,
      player == "Michael Llodra" ~ 2.320041,
      player == "Ernests Gulbis" ~ 24.1051846,
      player == "Albert Montanes" ~ 0.5900091,
      player == "Juan Monaco" ~ -59.1356957,
      player == "David Nalbandian" ~ -64.3164639,
      player == "Viktor Troicki" ~ 20.4568974,
      player == "Juan Carlos Ferrero" ~ -0.6099929,
      player == "Thomaz Belluci" ~ -48.450554,
      player == "Feliciano Lopez" ~ -4.0239568,
      player == "Guillermo Garcia Lopez" ~ -2.1581637,
      player == "Philipp Kohlschreiber" ~ 10.8979522,
      player == "Yen Hsun Lu" ~ 121.31143188476562,
      player == "Andrey Golubev" ~ 44.7519454,
      player == "Florian Mayer" ~ 11.5763079,
      player == "Juan Ignacio Chela " ~ -58.40231704711914,
      player == "Jarkko Nieminen" ~ 22.1,
      player == "Denis Istomin" ~ 55.0978517,
      player == "Gilles Simon" ~ 7.2683912,
      player == "Marcel Granollers" ~ 2.1774322,
      player == "Thiemo De Bakker" ~ 4.315730094909668,
      player == "Julien Benneteau" ~ 5.225506782531738,
      player == "Jeremy Chardy" ~ -0.3685668,
      player == "Sergiy Stakhovsky" ~ 30.5241361,
      player == "Potito Starace" ~ 14.7057054,
      player == "Alexandr Dolgopolov" ~ 30.5241361,
      player == "Janko Tipsarevic" ~ 20.4568974,
      player == "Tommy Robredo" ~ 2.6330963,
      player == "Victor Hanescu" ~ 26.10515022277832,
      player == "Andreas Seppi" ~ 11.3547399,
      player == "Benjamin Becker" ~ 6.6374902,
      player == "Lleyton Hewitt" ~ 138.599853515625,
      player == "Fabio Fognini" ~ 7.7748827,
      player == "Daniel Gimeno Traver" ~ -0.3763353,
      player == "Philipp Petzschner" ~ 11.5763079,
      player == "Michael Berrer" ~ 9.177595138549805,
      player == "Mikhail Kukushkin" ~ 44.5153353,
      player == "Xavier Malisse" ~ 3.2659884,
      player == "Kevin Anderson" ~ 28.041763305664062,
      player == "Radek Stepanek" ~ 18.5416556,
      player == "Pablo Cuevas" ~ -58.01738357543945,
      player == "Santiago Giraldo" ~ -75.6946778,
      player == "Robin Haase" ~ 4.315730094909668,
      player == "Carlos Berlocq" ~ -58.0138252,
      player == "Tobias Kamke" ~ 10.684738,
      player == "Fernando Gonzalez" ~ -33.4377756,
      player == "Florent Serra" ~ -0.5800364,
      player == "Pablo Andujar" ~ -2.1313528,
      player == "Pere Riba" ~ 2.1774322,
      player == "Ivo Karlovic" ~ 15.9772795,
      player == "Eduardo Schwank" ~ -60.6617024,
      player == "Dudi Sela" ~ 35.56822204589844,
      player == "Ricardo Mello" ~ -47.059564,
      player == "Ruben Ramirez Hidalgo" ~ -0.4881708,
      player == "Arnaud Clement" ~ 5.4474738,
      player == "Igor Andreev" ~ 37.6174782,
      player == "Teymuraz Gabashvili" ~ 44.8014495,
      player == "Illya Marchenko" ~ 34.6068797,
      player == "Mischa Zverev" ~ 37.6174782,
      player == "Rainer Schuettler" ~ 8.8426963,
      player == "Brian Dabul" ~ -58.54913330078125,
      player == "Michal Przysiezny" ~ 16.0935567,
      player == "Ricardas Berankis" ~ 25.289478302001953,
      player == "Ivan Dodig" ~ 16.9797134,
      player == "Lukas Lacko" ~ 17.8213848,
      player == "Marsel Ilhan" ~ 66.96456146240234,
      player == "Filippo Volandri" ~ 10.3402787,
      player == "Dustin Brown" ~ 10.081052,
      player == "Rui Machado" ~ -7.9351771,
      player == "Leonardo Mayer" ~ ,
      player == "Jan Hajek" ~ ,
      player == "Marcos Daniel" ~ ,
      player == "Paul Henri Mathieu" ~ ,
      player == "Kei Nishikori" ~ ,
      player == "Michael Russell" ~ ,
      player == "Igor Kunitsyn" ~ 
      
      
      
      
      
      
      
      
      
      
      
      
      
      )
  )

rankings2023 <- rankings_100 %>% filter(year(rank_date) == 2023)

world_map <- map_data("world") %>% 
  filter(! long > 180)

world_map %>%
  ggplot() +
  geom_map(map = world_map, aes(x = long, y = lat, map_id = region), color = "darkgreen", fill = "tan") +
  coord_map("moll") +
  geom_jitter(data = rankings2023,
              aes(birth_long, birth_lat), width = 1, height = 1, size = 1.5) +
  labs(x = "Longitude", y = "Latitude", title = "2023 ATP Top 100")

rankings2023 %>% slice(20:30)
